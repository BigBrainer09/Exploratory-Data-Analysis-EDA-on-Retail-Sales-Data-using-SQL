
-- 1. DATABASE EXPLORATION

-- Explore all objects in the datanase
SELECT * FROM INFORMATION_SCHEMA.TABLES;

-- Explore all columns in the datanase
SELECT * FROM INFORMATION_SCHEMA.COLUMNS;


-- 2. DIMENSIONS EXPLORATION

-- Explore all countries our customers come from
SELECT 
	DISTINCT country 
FROM gold.dim_customers;

-- Explore all categories of products
SELECT 
	DISTINCT category,
	subcategory,
	product_name
FROM gold.dim_products
ORDER BY 1,2,3;


-- 3. DATE EXPLORATION

-- Find date of the first and last order
SELECT 
	MAX(order_date) AS last_order,
	MIN(order_date) AS first_order,
	DATEDIFF(year,MIN(order_date),MAX(order_date)) AS date_range_in_years
FROM gold.fact_sales;

-- Find the youngest and the oldest customer
SELECT 
	DATEDIFF(year, MAX(birthdate), GETDATE()) AS oldest_customer,
	DATEDIFF(year, MIN(birthdate), GETDATE()) AS youngest_customer
FROM gold.dim_customers;


-- 4. MEASURES EXPLORATION

-- Find total sales 
SELECT 
	SUM(sales_amount) AS total_sales
FROM gold.fact_sales;

-- Find how many items are sold 
SELECT
	COUNT(quantity) AS total_quantity
FROM gold.fact_sales;

-- Find the average selling price 
SELECT
	AVG(price) AS avg_selling_price
FROM gold.fact_sales;

-- Find total number of orders
SELECT
	COUNT(DISTINCT order_number) AS total_orders
FROM gold.fact_sales;

-- Find total number of products
SELECT
	COUNT(DISTINCT product_key) AS total_products
FROM gold.dim_products;

-- Find total number of customers
SELECT
	COUNT(customer_key) AS total_customers
FROM gold.dim_customers;

-- Find total number of customers that has placed an order
SELECT
	COUNT(DISTINCT customer_key) AS customers_who_placed_order
FROM gold.fact_sales;

-- Making a report of this 
SELECT 
	'total_sales' AS measure_name,
	SUM(sales_amount) AS measure_value
FROM gold.fact_sales
UNION ALL
SELECT
	'total_quantity' AS measure_name,
	COUNT(quantity) AS measure_value
FROM gold.fact_sales
UNION ALL
SELECT
	'avg_selling_price' AS measure_name,
	AVG(price) AS measure_value
FROM gold.fact_sales
UNION ALL
SELECT
	'total_orders' AS measure_name,
	COUNT(DISTINCT order_number) AS measure_value
FROM gold.fact_sales
UNION ALL
SELECT
	'total_products' AS measure_name,
	COUNT(DISTINCT product_key) AS measure_value
FROM gold.dim_products
UNION ALL
SELECT
	'total_customers' AS measure_name,
	COUNT(customer_key) AS measure_value
FROM gold.dim_customers
UNION ALL
SELECT
	'customers_who_placed_order' AS measure_name,
	COUNT(DISTINCT customer_key) AS measure_value
FROM gold.fact_sales


-- 5. MAGNITUDE
-- [Measure] By [Dimension]

-- Find total customers by countries
SELECT 
	country,
	COUNT(customer_id) AS total_customers
FROM gold.dim_customers
GROUP BY country
ORDER BY total_customers DESC;

-- Find total customers by gender
SELECT 
	gender,
	COUNT(customer_id) AS total_customers
FROM gold.dim_customers
GROUP BY gender
ORDER BY total_customers DESC;

-- Find total products by category
SELECT 
	category,
	COUNT(product_id) AS total_products
FROM gold.dim_products
GROUP BY category
ORDER BY total_products DESC;

-- What is the average costs in each category?
SELECT 
	category,
	AVG(cost) AS avg_cost
FROM gold.dim_products
GROUP BY category
ORDER BY avg_cost DESC;

-- What is the total revenue generated for each category?
SELECT 
	p.category,
	SUM(s.price) AS total_revenue
FROM gold.dim_products p
LEFT JOIN gold.fact_sales s ON p.product_key = s.product_key
GROUP BY p.category
ORDER BY total_revenue DESC;

-- Find total revenue is generated by each customer
SELECT 
	c.customer_key,
	SUM(s.sales_amount) AS total_revenue
FROM gold.dim_customers c
LEFT JOIN gold.fact_sales s ON c.customer_key = s.customer_key
GROUP BY c.customer_key
ORDER BY total_revenue DESC;

-- What is the distribution of sold items across countries?
SELECT 
	c.country,
	SUM(s.sales_amount) AS total_revenue
FROM gold.dim_customers c
LEFT JOIN gold.fact_sales s ON c.customer_key = s.customer_key
GROUP BY c.country
ORDER BY total_revenue DESC;


-- 6. RANKING
-- Ordering the values of dimensions by measure

-- Which 5 products generate the highest revenue
SELECT TOP 5
	p.product_name,
	SUM(s.price) AS total_revenue
FROM gold.dim_products p
LEFT JOIN gold.fact_sales s ON p.product_key = s.product_key
GROUP BY p.product_name
ORDER BY total_revenue DESC;

-- Which 5 products generate the lowest revenue
SELECT TOP 5
	p.product_name,
	SUM(s.price) AS total_revenue
FROM gold.dim_products p
RIGHT JOIN gold.fact_sales s ON p.product_key = s.product_key
GROUP BY p.product_name
ORDER BY total_revenue;




